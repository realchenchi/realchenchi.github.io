<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>交易系统 on 马野先生</title>
    <link>/tags/%E4%BA%A4%E6%98%93%E7%B3%BB%E7%BB%9F/</link>
    <description>Recent content in 交易系统 on 马野先生</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh_CN</language>
    <lastBuildDate>Tue, 19 May 2020 00:00:00 +0000</lastBuildDate>
    
	<atom:link href="/tags/%E4%BA%A4%E6%98%93%E7%B3%BB%E7%BB%9F/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>百亿级微信红包的高并发资金交易系统设计方案</title>
      <link>/post/2020-05-19%E7%99%BE%E4%BA%BF%E7%BA%A7%E5%BE%AE%E4%BF%A1%E7%BA%A2%E5%8C%85%E7%9A%84%E9%AB%98%E5%B9%B6%E5%8F%91%E8%B5%84%E9%87%91%E4%BA%A4%E6%98%93%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/</link>
      <pubDate>Tue, 19 May 2020 00:00:00 +0000</pubDate>
      
      <guid>/post/2020-05-19%E7%99%BE%E4%BA%BF%E7%BA%A7%E5%BE%AE%E4%BF%A1%E7%BA%A2%E5%8C%85%E7%9A%84%E9%AB%98%E5%B9%B6%E5%8F%91%E8%B5%84%E9%87%91%E4%BA%A4%E6%98%93%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88/</guid>
      <description>本文由 简悦 SimpRead 转码， 原文地址 https://www.infoq.cn/article/2017hongbao-weixin
 2017 年 1 月 28 日，正月初一，微信公布了用户在除夕当天收发微信红包的数量——142 亿个，而其收发峰值也已达到 76 万每秒。百亿级别的红包，如何保障并发性能与资金安全？这给微信带来了超级挑战。面对挑战，微信红包在分析了业界 “秒杀” 系统解决方案的基础上，采用了 SET 化、请求排队串行化、双维度分库表等设计，形成了独特的高并发、资金安全系统解决方案。实践证明，该方案表现稳定，且实现了除夕夜系统零故障运行。
本文将为读者介绍百亿级别红包背后的系统高并发设计方案，包括微信红包的两大业务特点、微信红包系统的技术难点、解决高并发问题通常使用的方案，以及微信红包系统的高并发解决方案。
一、微信红包的两大业务特点 微信红包（尤其是发在微信群里的红包，即群红包）业务形态上很类似网上的普通商品 “秒杀” 活动。
用户在微信群里发一个红包，等同于是普通商品 “秒杀” 活动的商品上架；微信群里的所有用户抢红包的动作，等同于 “秒杀” 活动中的查询库存；用户抢到红包后拆红包的动作，则对应 “秒杀” 活动中用户的 “秒杀” 动作。
不过除了上面的相同点之外，微信红包在业务形态上与普通商品 “秒杀” 活动相比，还具备自身的特点：
首先，微信红包业务比普通商品 “秒杀” 有更海量的并发要求。
微信红包用户在微信群里发一个红包，等同于在网上发布一次商品 “秒杀” 活动。假设同一时间有 10 万个群里的用户同时在发红包，那就相当于同一时间有 10 万个 “秒杀” 活动发布出去。10 万个微信群里的用户同时抢红包，将产生海量的并发请求。
其次，微信红包业务要求更严格的安全级别。
微信红包业务本质上是资金交易。微信红包是微信支付的一个商户，提供资金流转服务。
用户发红包时，相当于在微信红包这个商户上使用微信支付购买一笔 “钱”，并且收货地址是微信群。当用户支付成功后，红包“发货” 到微信群里，群里的用户拆开红包后，微信红包提供了将 “钱” 转入折红包用户微信零钱的服务。
资金交易业务比普通商品 “秒杀” 活动有更高的安全级别要求。普通的商品 “秒杀” 商品由商户提供，库存是商户预设的，“秒杀”时可以允许存在“超卖”（即实际被抢的商品数量比计划的库存多）、“少卖”（即实际被抢的商户数量比计划的库存少）的情况。但是对于微信红包，用户发 100 元的红包绝对不可以被拆出 101 元；用户发 100 元只被领取 99 元时，剩下的 1 元在 24 小时过期后要精确地退还给发红包用户，不能多也不能少。</description>
    </item>
    
  </channel>
</rss>